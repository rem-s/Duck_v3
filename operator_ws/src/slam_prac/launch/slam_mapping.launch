<?xml version="1.0"?>
<launch>
    
    <!-- when use rosbag simulation, set to true -->
    <param name="use_sim_time" value="false"/>

    <!-- launch rplidar launch file for scanning -->
    <!-- LiDAR roslaunch will be executed by duck3 -->
    <!-- <include file="$(find rplidar_ros)/launch/rplidar.launch">
        <arg name="frame_id" value="base_scan"/>

    </include> -->
    
    <!-- Node launched from ***rems-jetson*** START -->
    <machine name="rems-jetson" address="192.168.1.10" env-loader="/home/rems/catkin_ws/env_remote.sh" user="rems"/>
    <!-- password="duckduck" -->
    <arg name="frame_id" default="base_scan"/>
    <node machine="rems-jetson" pkg="rplidar_ros" type="rplidarNode" name="rplidarNode">
        <param name="serial_port"         type="string" value="/dev/ttyUSB0"/>
        <param name="serial_baudrate"     type="int"    value="115200"/><!--A1/A2 -->
        <!--param name="serial_baudrate"     type="int"    value="256000"--><!--A3 -->
        <param name="frame_id"            type="string" value="$(arg frame_id)"/>
        <param name="inverted"            type="bool"   value="false"/>
        <param name="angle_compensate"    type="bool"   value="true"/>
        <param name="scan_mode"           type="string" value="Standard"/>
    </node>

    <node machine="rems-jetson" pkg="gpio_ctl" type="run_mechanum.py" name="run_mechanum" />
    <!-- Node launched from ***rems-jetson*** END -->
    
    <!-- remote controller with joystick -->
    <node pkg="joy" type="joy_node" name="joy_node">

    </node>

    <node pkg="duck_sensor" type="teleop_cmd_str" name="teleop_cmd_str" />

    <!-- use scan_tools to get required tf frames base_link to world -->
    <node pkg="laser_scan_matcher" type="laser_scan_matcher_node" name="laser_scan_matcher">
        <!-- coordinate frames -->
        <param name="fixed_frame" value="odom"/>
        <param name="base_frame" value="base_link"/>
        
        <!-- motion prediction -->
        <param name="use_imu" value="false"/>
        <param name="use_odom" value="false"/>
        <param name="use_vel" value="false"/>
    </node>

    <!-- tf transform baselink to basescan -->
    <node pkg="tf2_ros" type="static_transform_publisher" name="baselink_to_basescan" args="0 0 0.20 0 0 0 base_link base_scan"/>

    <!-- use gmapping for 2d-slam algorithm -->
    <include file="$(find gmapping)/launch/gmapping.launch" />

    <!-- rviz -->
    <node pkg="rviz" type="rviz" name="rviz" args="-d $(find slam_prac)/rviz/slam_mapping_demo.rviz" />
    
</launch>